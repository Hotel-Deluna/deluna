<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.hotel.mapper.MemberMapper">

 	<select id="checkByEmail" resultType="String">
		
		select email from d_member where email = #{email}
		
	</select>
	
	<select id="deleteMemberInfo" resultType="map">
		
		select member_num, role from d_member where email = #{email}
		
	</select>
	
	<insert id="registerMemberInfo" parameterType="map">
	
		insert into d_member (name, phone_num, email, password, role, is_delete, dt_insert, insert_user) 
		values(#{name},#{phone_num},#{email},#{password}, #{role}, 'N', NOW(), 'member');
	
	</insert>
	
	<update id="deleteMember" parameterType="map">
	
		update d_member set is_delete='Y', dt_update= NOW(), update_user=#{update_user} where email=#{email}
	
	</update>
	
	<insert id="insertDeleteMember" parameterType="map">
	
		insert into d_member_delete (member_num, content, dt_insert, insert_user) 
		values(#{member_num}, #{content}, NOW(), #{update_user});
	
	</insert>
	
	<update id="updateMemberInfo" parameterType="map">
	
		update d_member set name = #{name}, phone_num = #{phone_num}, dt_update= NOW() where email=#{email}
	
	</update>
	
	<select id="viewMemberInfo" resultType="com.hotel.member.vo.MemberVo$MemberInfo" >
		
		select email, name, phone_num, role, insert_user from d_member where email=#{email}
		
	</select>
	
	<select id="findByEmail" resultType="String">
		
		select email from d_member where phone_num = #{phone_num} and name = #{name}
		
	</select>
	
	<select id="checkEmailByPwd" resultType="String">
		
		select email from d_member where phone_num = #{phone_num} and name = #{name}
		
	</select>
	
	<select id="selectMemberNum" resultType="String">
		
		select insert_user from d_member where email = #{email}
		
	</select>
	
	<!-- <update id="updateEmailAuthInfo" parameterType="com.hotel.member.vo.MemberVo$MemberEmailAuthInfo">
	
		update d_email_auth set email_auth_num = #{email_auth_num}, user_num = #{user_num}, dt_insert = NOW()
	
	</update> -->
	
	<insert id="updateEmailAuthInfo" parameterType="com.hotel.member.vo.MemberVo$MemberEmailAuthInfo">
	
		insert into d_email_auth values(0, #{email_auth_num},#{user_num}, NOW())
		
	</insert>
	
	<select id="checkEmailAuthInfo" resultType="string">
		
		select email_auth_num from d_email_auth where user_num = #{user_num} and email_auth_num = #{email_auth_num}
		
	</select>
	
	<update id="updatePwdInfo" parameterType="com.hotel.member.vo.MemberVo$MemberUpdatePwdRequest">
	
		update d_member set password = #{password} where email = #{email} and insert_user = #{user_num}
	
	</update>

</mapper>